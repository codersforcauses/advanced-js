<html>

<head>
  <title>Requestify</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 -15 120 120%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¬</text></svg>">
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <div class="container">
    <h1>Requestify</h1>
    <div class="flex">
      <p><i>Best requests in the west</i></p>
      <button id="button" onclick="getData();">Request data</button>
    </div>
    <div id='display-container'></div>
    <div id='code-block'></div>
  </div>
  <div class="footer">Made with <3 by cfc</div>
</body>
<script type="text/javascript" src="renderjson.js"></script>
<script type='module' crossorigin>
let code = document.querySelector('#code-block');
let display = document.querySelector('#display-container');
let button = document.querySelector('#button');
code.innerText = 'Welcome to Requestify';
renderjson.set_show_to_level(5).set_icons('+', '-')

function makeCard({
  address: { street, suite, city, zipcode, geo },
  name,
  email,
  phone,
  username,
  website
}) {
  const card = document.createElement('div');
  card.setAttribute('class', 'card')
  const div = `
    <h3>${name} (${username})</h3>
    <p>Email: <i>${email}</i></p>
    <p>Phone: ${phone}</p>
    <p>Website: <a href="">${website}</a></p>
    <p>
      <small>
        ${suite}<br>
        ${street}, ${city}<br>
        ${zipcode}
      </small>
    </p>
  `
  card.innerHTML = div;
  display.appendChild(card)
}

// function for creating a card with data
function displayData(data) {
  const [ firstUser ] = data
  makeCard(firstUser)
}

// function for button
async function getData() {
  try {
    button.innerText = 'Loading...'
    const response = await fetch('https://jsonplaceholder.typicode.com/users')
    const data = await response.json()
    if (Object.keys(data).length === 0) throw { code: 500, message: 'Server error'};
    code.innerText = ''
    code.appendChild(renderjson(data))
    display.innerHTML = ''
    displayData(data)
  } catch(err) {
    console.log('error:', err);
    code.innerText = 'Error:'
    code.appendChild(renderjson(err))
  }
  button.innerText = "Request data"
}
// need this declaration as type="module" is isolated from html
window.getData = getData;
</script>

</html>